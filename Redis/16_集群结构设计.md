**数据存储设计**

+ 通过算法设计，计算出key应该保存的位置

+ 将所有的存储空间计划切割成16384份，每台主机保存一部分每份代表的是一个存储空间，不是一个key的保存空间

+ 将key按照计算出的结果放到对应的存储空间

**集群内部通讯设计**

![image-20200830210313090](C:\Users\星星\AppData\Roaming\Typora\typora-user-images\image-20200830210313090.png)

**Cluster集群结构搭建**

+ Cluster配置

  ```
  #添加节点
  cluster-enabled yes|no
  #cluster配置文件名，该文件属于自动生成，仅用于快速查找文件并查询文件内容
  cluster-config-file <filename>
  #节点服务响应超时时间，用于判定该节点是否下线或切换为从节点
  cluster-node-timeout <milliseconds>
  #master连接的slave最小数量
  cluster-migration-barrier <count>
  ```

  ![image-20200830210849752](C:\Users\星星\AppData\Roaming\Typora\typora-user-images\image-20200830210849752.png)

  ![image-20200830211257105](C:\Users\星星\AppData\Roaming\Typora\typora-user-images\image-20200830211257105.png)

+ 将节点连接到一块

  + replicas 1 m1IP m2IP s1IP s2IP
  + replicas 2 m1IP m2IP s1IP01 s1IP02 s2IP01 s2IP02 

  ![image-20200830211446491](C:\Users\星星\AppData\Roaming\Typora\typora-user-images\image-20200830211446491.png)

  ![image-20200830212049502](C:\Users\星星\AppData\Roaming\Typora\typora-user-images\image-20200830212049502.png)

  ![image-20200830212134854](C:\Users\星星\AppData\Roaming\Typora\typora-user-images\image-20200830212134854.png)

  ![image-20200830212218786](C:\Users\星星\AppData\Roaming\Typora\typora-user-images\image-20200830212218786.png)

**Cluster集群注意**

+ 当集群内部的某个从节点挂掉，不会影响整个服务，当再次上线之后自动恢复。
+ 当集群内部的某个主节点挂掉，从节点会根据配置参数进行尝试连接，然后自己当选为主节点，不会影响整个服务，当再次上原来的主节点变成从节点
+ 当增加新节点时redis可以自动重新分配数据，让这台新节点参与进来，当有节点退出时也会重新分配，从而保证整个服务的稳定性。