**哨兵简介**

+ 哨兵(sentinel) 是一个分布式系统，用于对主从结构中的每台服务器进行监控，当出现故障时通过投票机制选择新的master并将所有slave连接到新的master。
+ 哨兵也是一台redis服务器，只是不提供数据服务通常哨兵配置数量为单数

**配置哨兵**

+ 将所有哨兵监听的服务统称为myaster,然后针对mymastr进行调控处理

  ```
  sentinel auth-pass mymaster 123456 监听服务器密码
  sentinel monitor mymaster 192.168.194.131 6381 1 监听服务器地址
  sentinel down-after-milliseconds mymaster 3000 监听的服务如果3000毫秒没有相应则认定服务挂掉
  sentinel parallel-syncs mymaster 2  如果mymastr超过2个出现问题，则认定服务挂掉了
  sentinel failover-timeout mymaster 1800 如果指定出现故障后，故障切换的最大超时时间18秒，超过该值，认定切换失败，默认3分钟
  ```

![image-20200830184121070](C:\Users\星星\AppData\Roaming\Typora\typora-user-images\image-20200830184121070.png)

![image-20200830184130885](C:\Users\星星\AppData\Roaming\Typora\typora-user-images\image-20200830184130885.png)

**哨兵工作原理**

1. 监控阶段

   + ![image-20200830184551053](C:\Users\星星\AppData\Roaming\Typora\typora-user-images\image-20200830184551053.png)

   + ![image-20200830184631657](C:\Users\星星\AppData\Roaming\Typora\typora-user-images\image-20200830184631657.png)

2. 通知阶段

   ![image-20200830184942775](C:\Users\星星\AppData\Roaming\Typora\typora-user-images\image-20200830184942775.png)

3. 故障转移阶段

   1. 通知阶段

      ![image-20200830185116796](C:\Users\星星\AppData\Roaming\Typora\typora-user-images\image-20200830185116796.png)

   2. 派一个哨兵去处理redis主从问题（哨兵选举阶段，ruft协议选举规则）

      ![image-20200830185202648](C:\Users\星星\AppData\Roaming\Typora\typora-user-images\image-20200830185202648.png)

   3. 哨兵进行redis主从选举

      ![image-20200830185832690](C:\Users\星星\AppData\Roaming\Typora\typora-user-images\image-20200830185832690.png)

