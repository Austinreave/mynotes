### 一次http请求的整个过程

1. 浏览器本身是⼀个客户端，当你输⼊URL的时候，⾸先浏览器会去请求DNS服务器，通过DNS获取相应的域名对应的IP，然后通过IP地址找到IP对应的服务器后，进行建⽴TCP连接。
2. 浏览器发送HTTP Request（请求）包，服务器接收到请求包之后才开始处理请求包，服务器调⽤⾃身服务，返回HTTP Response（响应）包。
3. 客户端收到来⾃服务器的响应后开始渲染这个Response包⾥的主体，等收到全部的内容随后断开与该服务器之间的TCP连接。
4. 当解析到HTML DOM⾥⾯的图⽚连接，css脚本和js脚本的连接，浏览器会⾃动发起⼀个请求静态资源的HTTP请求，获取相应静态资源，然后浏览器会渲染出来，最终将所有资源整合、渲染、完整展现在屏幕上。(⽹⻚优化有⼀向措施是减少HTTP请求次数，把尽量多的css和js资源合并在⼀起)。

### session、cookie、token

由于http的无状态性，为了使某个域名下的所有网页能够共享某些数据，session和cookie出现了。客户端访问服务器的流程如下

1. 首先，客户端会发送一个http请求到服务器端。
2. 服务器端接受客户端请求后，建立一个session，并发送一个http响应到客户端，这个响应头，其中就包含Set-Cookie头部。该头部包含了sessionId。Set-Cookie格式如下，`Set-Cookie: value[; expires=date][; domain=domain][; path=path][; secure]`
3. 在客户端发起的第二次请求，假如服务器给了set-Cookie，浏览器会自动在请求头中添加cookie
4. 服务器接收请求，分解cookie，验证信息，核对成功后返回response给客户端

##### cookie和session使用注意

- cookie只是实现session的其中一种方案。虽然是最常用的，但并不是唯一的方法。禁用cookie后还有其他方法存储，比如放在url中
- 现在大多都是Session + Cookie，但是只用session不用cookie，或是只用cookie，不用session在理论上都可以保持会话状态。可是实际中因为多种原因，一般不会单独使用
- 用session只需要在客户端保存一个id，实际上大量数据都是保存在服务端。如果全部用cookie，数据量大的时候客户端是没有那么多空间的。
- 如果只用cookie不用session，那么账户信息全部保存在客户端，一旦被劫持，全部信息都会泄露。并且客户端数据量变大，网络传输的数据量也会变大
- 简而言之, session 有如用户信息档案表，里面包含了用户的认证信息和登录状态等信息， 而 cookie 就是用户通行证

##### token（认证流程与cookie很相似）

- 用户登录，成功后服务器返回Token给客户端
- 客户端收到数据后保存在客户端
- 客户端再次访问服务器，将token放入headers中
- 服务器端校验成功则返回请求数据，校验失败则返回错误码

### CSRF攻击

##### 攻击的核心原理是：通过cookie进行攻击

假如 A（被攻击网站) B（恶意攻击网站)，想要攻击得具备什么条件

1. 用户已经登录A网站，并生成cookie信息（一般包含了一个session_id和服务端会话）
2. B网站得有一个专门攻击A网站的脚本（这个脚本包含A网站的某个接口地址和请求参数）
3. B网站必须诱导用户点击这个脚本才能攻击A网站（因为用户的浏览器存有cookie信息）

怎么防范

1. 通过请求header的Referer参数判断是不是自己网站发起的请求。
2. 通过token方式验证，因为其他网站请求过来的header里没有token

### XSS攻击

##### XSS攻击的核心原理是：它会通过合法的操作（在评论框中输入），向你的页面注入脚本（可能是js、html代码块等）。

怎么防范

1. 对用户输入的数据进行HTML Entity 编码

2. 一些字符进行转化，使得浏览器在最终输出结果上是一样的。

   ```
   <script>alert(1)</script> 转化成 alert(1)等
   ```

   

